require 'spec_helper'

describe Tapyrus::Message::Headers do
  describe 'parse from payload' do
    subject do
      Tapyrus::Message::Headers.parse_from_payload(
        '04010000005fa53a1b345060c58628a4f45a2117e999997bcd807597b9bec5e823d42907704e2f728000d51cff5376dad21a8af63adc4a0277969584eb50cd369c83229cfa83466fcb5517ed6a1f65acac95200ce6045f7bee539b764fbc2bd14e48682d71438e225f00403f0d80d8fa3f1fb3ff3acac2489b5250b064bf0e61f274ec0952efb993c3bbfddf60128c6ea5b8b202b426508648cf770e94df54c0cbf9d8cd40ceee7382c6900001000000726b5391f689475bd30c44853e7d167945715a774edd7b423159910b6cd211c3ea411b76bcf0bb64654d3ff4e0df62d546801abab032f7a16761f4ff9acbe12469af7bea7f118b52cf08cd91e0e622a15471dc6398e42554dc5d5457d9d934c4448e225f00409fbd4951af5e0bb0850c64106e2e82471795f89c4dc17dc2a085550035f377ce8b6efe288ffa45972db140aef41ecbeac8dca4ae53f4a5dcba3ecd1cf2d79bd70001000000d6520aa7c82d34586ed1b578c5dd8808bdc22dcd2903dce3d7c5578fc1d82b413c8ad66492e2622a33c7c95758ebb3e1daeb14d2674c63250ed06845cfd2c6f9e7369288d4854f033ac7789d26fcfef01e9111e3e8a5f5904194109e0a5244c5458e225f0040cc31a2296e8e63fc2eef89fc9d53555748fbf56d8299c04461067f591b040db4d4fbce072e9d3bb4837fa68fe2ba8329f87c4be978c3565f7417d2a1d607d6f60001000000c8e2f66ab581e5081d684097587a310c57efd48f701a16aa9f9f4bd75b883207e773a662bd853488b40646c761a3cf5ced5d793a7d7c14dc3b376cf190647ac0b67cc772c79cb87e053542877af27e2d6d2e6eccc330b5526db74d6b72555595468e225f0040a1138397bae157abf178cd71f92ab11af3df9ff037203b43856ab0e982949fa6aa85b04cb9b5e885151627b06f94eaf19a8a7c75e9d7f18c817a4f2ec32ce7ea00'
          .htb
      )
    end
    it 'should be parsed' do
      expect(subject.headers.length).to eq(4)
      expect(subject.headers[0].block_hash).to eq('726b5391f689475bd30c44853e7d167945715a774edd7b423159910b6cd211c3')
      expect(subject.headers[1].block_hash).to eq('d6520aa7c82d34586ed1b578c5dd8808bdc22dcd2903dce3d7c5578fc1d82b41')
    end
  end

  describe 'to_pkt' do
    subject do
      h =
        Tapyrus::BlockHeader.parse_from_payload(
          '010000006c281f247858b3a15a883883f3b6c088a0e933d97bc47688e504f5be9f2cee77e476dba79e75fc0263c917d2ab40a34c1ab7510aba4020d79fa9ad3cfb3ae834c716cff6adf31e2846e905d391f89b3ca81273db405ad1ca0945b79f2c795e023cc3bc5e0040352d6ca481aeab106383da215e05109fa9167ec8284a8e0864905a990f3a1fb67d4a3d4c2111d51c3d9597a5ebd5f466b7959e80250edaf43b62978389d8e867'
            .htb
        )
      Tapyrus::Message::Headers.new([h]).to_pkt
    end
    it 'should be generate' do
      expect(subject.bth).to eq(
        '0b110907686561646572730000000000ac000000dd27e57a01010000006c281f247858b3a15a883883f3b6c088a0e933d97bc47688e504f5be9f2cee77e476dba79e75fc0263c917d2ab40a34c1ab7510aba4020d79fa9ad3cfb3ae834c716cff6adf31e2846e905d391f89b3ca81273db405ad1ca0945b79f2c795e023cc3bc5e0040352d6ca481aeab106383da215e05109fa9167ec8284a8e0864905a990f3a1fb67d4a3d4c2111d51c3d9597a5ebd5f466b7959e80250edaf43b62978389d8e86700'
      )
    end
  end
end
